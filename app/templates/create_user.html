{% extends "layouts/topbar.html" %}

{% block topbar %}
    {% include "sections/topbar.html" %}
{% endblock %}

{% block main_content %}
    <div class="dashboard-content" id="app"> 
        <h2>Create User</h2>
        
        <div class="errors">
            <ul>
                <li v-if="errors.passwords_do_not_match">Passwords do not match.</li>
            </ul>
        </div>
        <table>
            <tr>
                <td>First Name</td>
                <td>
                    <input v-model="user.first_name" type="text" placeholder="John" />
                </td>
            </tr>
            <tr>
                <td>Last Name</td>
                <td>
                    <input v-model="user.last_name" type="text" placeholder="Doe" />
                </td>
            </tr>
            <tr>
                <td>Username</td>
                <td>
                    <input v-model="user.username" type="text" placeholder="johndoe" /> 
                </td>
            </tr>
            <tr>
                <td>Password</td>
                <td>
                    <input  v-model="user.password" type="password" placeholder="" />
                </td>
            </tr>
            <tr>
                <td>Confirm Password</td>
                <td>
                    <input v-model="user.confirm_password" type="password" placeholder="" />
                </td>
            </tr>
            <tr>
                <td>Role</td>
                <td>
                    <select v-model="user.role">
                        <option value=1>Admin</option>
                        <option value=2>Volunteer</option>
                    </select>
                </td>
            </tr>
        </table>
        <button @click="signup">Create User</button>
    </div>
    <style>
        .dashboard-content {
            padding: 10px;
            margin-top: 20px;
        }
        .dashboard-content h3 {
            font-size: 22px;
        }
        .errors {
            color: red;
        }
    </style>

    <script>
        new Vue({
            el: "#app", 
            data : {
                user: {
                    first_name : "", 
                    last_name : "", 
                    username : "", 
                    password : "", 
                    role : ""
                },
                errors : {
                    passwords_do_not_match : false
                }
            },
            methods: {
                signup() {
                    if(this.validate()) {
                        this.commit()
                    }
                },
                validate() {
                    let error = 0
                    this.clear_errors() 

                    // check password and confirm passwords are the smae 
                    if(this.user.password != this.user.confirm_password) {
                        alert("There was an error signing the user up.")
                        this.errors.passwords_do_not_match = true 
                        error += 1
                    }

                    if(error == 0) return true 
                    else return false
                }, 
                clear_errors () {
                    for(let error in this.errors) {
                        this.errors[error] = false
                    }
                },
                commit() {
                    let self = this
                    axios.post("/api/create_user", { user: this.user })
                         .then((response) => {
                             alert("Successfully created user.")
                         })
                         .catch((error) => {
                             alert("There was an error in the server in signing you up.")
                         })
                }
            },
            delimiters : ["[[", "]]"]
        })
    </script>
{% endblock %}
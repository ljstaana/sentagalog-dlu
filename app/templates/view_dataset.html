{% extends "layouts/topbar.html" %} 

{% block topbar %}
    {% include "sections/topbar.html" %}
{% endblock %}


{% block main_content %}
    <div class="dashboard-content" id="app">
        <h3>Dataset</h3>
        Use the tool below to view the dataset contents:
        <br /> 
        <table>
            <tr>
                <td>Filter Field</td>
                <td>
                    <select>
                        <option v-model="options.field" v-for="field in fields">[[field]]</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Filter</td>
                <td>
                    <input v-model="options.filter" type="text" />
                </td>
            </tr>
            <tr>
                <td>Sort By</td>
                <td>
                    <select v-model="options.ord_field">
                        <option v-for="field in fields">[[field]]</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>Direction</td>
                    <td>
                        <select v-model="options.ord_dir">
                            <option>asc</option>
                            <option>desc</option>
                        </select>
                    </td>
                </tr>
        </table>
        <button @click="view_tweets()">Go</button>
        <hr />
        <div class="tweets-timeline">
            <div class="post" v-for="tweet in tweets">
                <big><a>@[[ tweet[0] ]]</a></big>
                <p>[[ tweet[1] ]]</p>
                <div>
                    <table>
                        <tr>
                            <td>[[ tweet[2] ]]</td>
                            <td>[[ tweet[3] ]]</td> 
                        </tr>
                        <tr>
                            <td>[[ tweet[4] ]]</td>
                            <td>[[ tweet[5] ]]</td>
                        </tr>
                        <tr>
                            <td>[[ get_sentiment(tweet[6]) || "Not Labelled Yet" ]]</td>
                            <td >[[ tweet[7] || "No One Labelled This Yet"]]</td>
        
                        </tr>
                        <tr>
                            <td colspan>
                                [[ tweet [8] || "No Reason for Label"]]
                            </td>
                            <td><a :href="'{{url_for('label_specific_tweet')}}?tweet_id=' + tweet[9]"><button>Label This</button></a></td>
                        </tr>
                        <tr>
                            <td>[[ tweet[9] ]]</td>
                        </tr>
                    </table>

                    <br />
                    <br />
                    <br /> 

                </div>
            </div>
        </div>
        <hr />
        <div align="center">
            Showing page  
            <input type="number" min="0" :max=" Math.ceil(ntweets/10) " v-model="options.offset" type="number" style="width: 20%" /> 
            of [[ Math.ceil(ntweets/10) ]] pages.
            <br /> 
            Tweets [[(offset-1)*10 + 1]]-[[(offset-1)*10+10]]/[[ntweets]]
            <br />
            <br />
            <button @click="prev">&lt; Prev</button>
            <button @click="view_tweets">Go</button>
            <button @click="next">Next &gt;</button>

        </div>
    </div> 
    <style>
        .dashboard-content {
            padding: 10px;
            margin-top: 20px;
        }
        .dashboard-content h3 {
            font-size: 22px;
        }
        .tweets-timeline {
            display: block; 
            color: black;
        }
        .slidable {
            display: none;
        }

        @media screen and (min-width: 720px) {
            .dashboard-content {
                width: 720px;
                margin: 0 auto;
            }
        }
    </style>
    <script> 
        new Vue({
            el: '#app', 
            data: {
                fields : [
                    "author", 
                    "text", 
                    "sentiment", 
                    "labeller", 
                    "reason", 
                    "search_term", 
                    "dataset_domain", 
                    "language", 
                    "post_date"
                ],
                options : {
                    field: "text", 
                    filter: "", 
                    ord_field: "text", 
                    ord_dir: "DESC", 
                    offset: 1, 
                    limit: 10
                },
                tweets : [{
                    author : "sdfdsf"
                }],
                offset : 1
            },
            methods: {
                view_tweets() {
                    let self = this
                    let options = this.options
                    axios.post("/view_tweets", options) 
                         .then((response) => {
                             self.tweets = response.data["tweets"]
                             self.ntweets = response.data["ntweets"]
                             self.offset = options.offset
                         })
                         .catch((err) => {
                             console.log(response.data)
                         })
                    window.scrollTo(0,0)
                },
                get_sentiment(code) {
                    if(code == 1) {
                        return "positive"
                    } else if (code == 0) {
                        return "neutral"
                    } else if (code == -1) {
                        return "negative"
                    } else if(code == -2) {
                        return "neutral"
                    } else if(code == 2) {
                        return "sarcasm"
                    } else {
                        return null
                    }
                },
                next() {
                    this.offset += 1 
                    this.view_tweets()
                },
                prev() { 
                    let self = this
                    if(self.offset - 1 > 0) {
                        self.offset -=1 
                        self.view_tweets()
                    }
                }
            },
            delimiters : ["[[", "]]"], 
            mounted: function() {
                this.view_tweets()
            }
        })
    </script>
{% endblock %}
